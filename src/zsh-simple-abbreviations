#!/usr/bin/env zsh

KEY_REGEX="^[[:alnum:]]+$"

if [[ $# -eq 0 ]]; then
	echo "zsh_simple_abbreviations: No sub-command provided."
	echo "Usage: zsh_simple_abbreviations --set <key> <value>"
	echo "       zsh_simple_abbreviations --unset <key>"
	echo ""
	echo "Examples:"
	echo "  zsh_simple_abbreviations --set gco 'git checkout'"
	echo "  zsh_simple_abbreviations --unset gco"
	return 1
fi

case $1 in
--set)
	if [[ $# -ne 3 ]]; then
		echo "zsh_simple_abbreviations: --set requires exactly 2 arguments: <key> <value>"
		echo "Usage: zsh_simple_abbreviations --set <key> <value>"
		echo ""
		echo "Example:"
		echo "  zsh_simple_abbreviations --set gco 'git checkout'"
		return 1
	fi

	local key=${2}
	local value=${3}

	if [[ ${key} =~ ${KEY_REGEX} ]]; then
		ZSH_SIMPLE_ABBREVIATIONS[$key]="${value}"
	else
		echo "zsh_simple_abbreviations: Invalid key '${key}'"
		echo "Keys must contain only alphanumeric characters (letters, numbers, and underscores)."
		echo ""
		echo "Valid examples: gco, git_status, gc1"
		echo "Invalid examples: git-checkout, my.abbr, hello!"
		return 1
	fi
	;;

--unset)
	if [[ $# -ne 2 ]]; then
		echo "zsh_simple_abbreviations: --unset requires exactly 1 argument: <key>"
		echo "Usage: zsh_simple_abbreviations --unset <key>"
		echo ""
		echo "Example:"
		echo "  zsh_simple_abbreviations --unset gco"
		return 1
	fi

	local key=${2}

	if [[ ${key} =~ ${KEY_REGEX} ]]; then
		unset "ZSH_SIMPLE_ABBREVIATIONS[${key}]"
	else
		echo "zsh_simple_abbreviations: Invalid key '${key}'"
		echo "Keys must contain only alphanumeric characters (letters, numbers, and underscores)."
		echo ""
		echo "Valid examples: gco, git_status, gc1"
		echo "Invalid examples: git-checkout, my.abbr, hello!"
		return 1
	fi
	;;

*)
	echo "zsh_simple_abbreviations: Unrecognized sub-command '$1'"
	echo "Available sub-commands: --set, --unset"
	echo ""
	echo "Usage:"
	echo "  zsh_simple_abbreviations --set <key> <value>"
	echo "  zsh_simple_abbreviations --unset <key>"
	return 1
	;;
esac
